<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Lecture 6: Mixed-effect regression</title>
    <meta charset="utf-8" />
    <meta name="author" content="Dr Nemanja Vaci" />
    <script src="libs/header-attrs-2.11/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/default-fonts.css" rel="stylesheet" />
    <script src="libs/clipboard-2.0.6/clipboard.min.js"></script>
    <link href="libs/shareon-1.4.1/shareon.min.css" rel="stylesheet" />
    <script src="libs/shareon-1.4.1/shareon.min.js"></script>
    <link href="libs/xaringanExtra-shareagain-0.2.6/shareagain.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-shareagain-0.2.6/shareagain.js"></script>
  </head>
  <body>
    <textarea id="source">

class: center
background-image: url("wundt.png")
background-size: contain
---


&lt;style type="text/css"&gt;
body, td {
   font-size: 15px;
}
code.r{
  font-size: 15px;
}
pre {
  font-size: 20px
}
.huge .remark-code { /*Change made here*/
  font-size: 200% !important;
}
.tiny .remark-code { /*Change made here*/
  font-size: 80% !important;
}


&lt;/style&gt;

## Press record

<style>.shareagain-bar {
--shareagain-foreground: rgb(255, 255, 255);
--shareagain-background: rgba(0,0,0,.2);
--shareagain-linkedin: none;
--shareagain-pinterest: none;
--shareagain-pocket: none;
--shareagain-reddit: none;
}</style>

---

## Corrections from the previous lecture

---

## R code

[LINK](https://nvaci.github.io/Lecture_6_code/Lecture_6code.html)

---

## Multilevel models 

Generalization of regression `\((y_i=\alpha+\beta*x_i+\epsilon_i)\)`, where we allow adjustments of: &lt;br/&gt;&lt;br/&gt;
- Intercept: `\(y_i = \alpha_{j[i]}+\beta*x_i+\epsilon_i\)` &lt;br/&gt;&lt;br/&gt;
- Slope: `\(y_i=\alpha*\beta_{j[i]}*x_i+\epsilon_i\)` &lt;br/&gt;&lt;br/&gt;
- Both: `\(y_i=\alpha_{j[i]}*\beta_{j[i]}*x_i+\epsilon_i\)`

---

## Analysis of the data

1. Complete pooling - take into account all observations, without hierarchical categories &lt;br/&gt;&lt;br/&gt;
2. No pooling - adjust regression for each hierarchical category  &lt;br/&gt; &lt;br/&gt;
3. Partial pooling - use categories to weight individual estimates &lt;br/&gt; &lt;br/&gt;

---

## Babies




```r
#install.packages('ggplot2')
require(ggplot2)
ggplot(data=Babies, aes(block, RT, group=subj_id))+geom_line()+geom_point()
```

&lt;img src="Mixed-effect2_files/figure-html/unnamed-chunk-2-1.png" style="display: block; margin: auto;" /&gt;

---

## Mixed-effect model: intercept


```r
#install.packages('lme4')
require(lme4)
lmer1&lt;-lmer(RT~block+(1|subj_id)+(1|item_id), data=Babies)
summary(lmer1)
```

```
## Linear mixed model fit by REML ['lmerMod']
## Formula: RT ~ block + (1 | subj_id) + (1 | item_id)
##    Data: Babies
## 
## REML criterion at convergence: 1335.5
## 
## Scaled residuals: 
##      Min       1Q   Median       3Q      Max 
## -1.94786 -0.74753  0.01814  0.57754  2.54454 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  subj_id  (Intercept)  6466.8   80.42  
##  item_id  (Intercept)   550.8   23.47  
##  Residual             39087.9  197.71  
## Number of obs: 100, groups:  subj_id, 10; item_id, 10
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept)  966.310     52.229   18.50
## block        104.088      7.352   14.16
## 
## Correlation of Fixed Effects:
##       (Intr)
## block -0.774
```

---

## Fixed effects - predictors


```r
#install.packages('sjPlot')
require(sjPlot)
plot_model(lmer1, type='pred')
```

```
## $block
```

&lt;img src="Mixed-effect2_files/figure-html/unnamed-chunk-4-1.png" style="display: block; margin: auto;" /&gt;

---

## Random effects - subjects


```r
plot_model(lmer1, type='re')[1]
```

```
## [[1]]
```

&lt;img src="Mixed-effect2_files/figure-html/unnamed-chunk-5-1.png" style="display: block; margin: auto;" /&gt;

---

## Baby 10 as an outlier


```r
Babies$RT=ifelse(Babies$subj_id==10, Babies$RT+500, Babies$RT)
ggplot(data=Babies, aes(block, RT, group=subj_id))+geom_line()+geom_point()
```

&lt;img src="Mixed-effect2_files/figure-html/unnamed-chunk-6-1.png" style="display: block; margin: auto;" /&gt;

---

## Random effects 2


```r
lmer1a&lt;-lmer(RT~block+(1|subj_id)+(1|item_id), data=Babies)
plot_model(lmer1a, type='re')[1]
```

```
## [[1]]
```

&lt;img src="Mixed-effect2_files/figure-html/unnamed-chunk-7-1.png" style="display: block; margin: auto;" /&gt;

---

## Baby 10 with missing data

&lt;style type="text/css"&gt;
pre {
  max-height: 300px;
  overflow-y: auto;
}

pre[class] {
  max-height: 100px;
}
&lt;/style&gt;

&lt;style type="text/css"&gt;
.scroll-100 {
  max-height: 100px;
  overflow-y: auto;
  background-color: inherit;
}
&lt;/style&gt;




```r
lmer1b&lt;-lmer(RT~block+(1|subj_id)+(1|item_id), data=Babies)
plot_model(lmer1b, type='re')[1]
```

```
## [[1]]
```

&lt;img src="Mixed-effect2_files/figure-html/unnamed-chunk-11-1.png" style="display: block; margin: auto;" /&gt;

---

## More uncertainty




```r
lmer1c&lt;-lmer(RT~block+(1|subj_id), data=Babies)
plot_model(lmer1c, type='re')
```

&lt;img src="Mixed-effect2_files/figure-html/unnamed-chunk-13-1.png" style="display: block; margin: auto;" /&gt;


---

## What does that mean practically

If there we have large variance between participants' behaviour and large number of observations for each participant -&gt; mixed-effect model will be similar to the no pooling situation  &lt;br/&gt;&lt;br/&gt;

If we have small variances between participants' behaviour and large number of observations for each participant -&gt; mixed effect model will be similar to the complete pooling situation &lt;br/&gt;&lt;br/&gt;

In any other case (medium sized variances, different number of observations per participants, outliers etc.) -&gt; mixed-effect model will be a compromise between these two cases &lt;br/&gt;&lt;br/&gt;

---

## Advice

You should always use mixed-effect models! &lt;br/&gt;&lt;br/&gt;

---

## Handball experiment

&lt;img src="Handball.png" width="80%" style="display: block; margin: auto;" /&gt;


```r
Handball&lt;-read.table('Handball_data.txt', sep='\t', header=T)
```

---

## Handball dataset




```r
head(Handball[,c('Subject','Time','Answer','Video2','RT2')])
```

```
##     Subject Time Answer Video2      RT2
## 172       1    1      0  S10C1 6.171701
## 282       2    1      0  S10C1 6.716595
## 370       3    1      0  S10C1 6.047372
## 637       4    1      0  S10C1 7.430707
## 846       5    1      1  S10C1 6.726233
## 966       6    1      0  S10C1 7.161622
```

---

## Random effects

&lt;img src="crossed2.png" width="50%" style="display: block; margin: auto;" /&gt;

---

## Linear mixed-effect model


```r
lmerRT&lt;-lmer(RT2~Exp*Time+(1|Subject)+(1|Video2), data=Handball)
print(summary(lmerRT), cor=F)
```

```
## Linear mixed model fit by REML ['lmerMod']
## Formula: RT2 ~ Exp * Time + (1 | Subject) + (1 | Video2)
##    Data: Handball
## 
## REML criterion at convergence: 5442.9
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -9.3532 -0.5322 -0.0813  0.4635  7.7592 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  Video2   (Intercept) 0.001543 0.03928 
##  Subject  (Intercept) 0.275340 0.52473 
##  Residual             0.255440 0.50541 
## Number of obs: 3598, groups:  Video2, 60; Subject, 20
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept)  6.93386    0.16729  41.449
## Exp2         0.22024    0.23647   0.931
## Time2       -0.25336    0.02918  -8.683
## Time3       -0.53388    0.02918 -18.296
## Exp2:Time2   0.12690    0.04128   3.074
## Exp2:Time3   0.33207    0.04129   8.043
```

---

## Visualisation of the results

&lt;img src="Mixed-effect2_files/figure-html/unnamed-chunk-20-1.png" style="display: block; margin: auto;" /&gt;

---
class: inverse, middle, center
# Beyond linear mixed-effect models 
---

## Generalized linear mixed-effect model

Logistic regression:


```r
AccMod&lt;-glmer(Answer~Exp*Time+(1|Subject)+(1|Video2), data=Handball, family=binomial('logit'))
summary(AccMod)
```

```
## Generalized linear mixed model fit by maximum likelihood (Laplace
##   Approximation) [glmerMod]
##  Family: binomial  ( logit )
## Formula: Answer ~ Exp * Time + (1 | Subject) + (1 | Video2)
##    Data: Handball
## 
##      AIC      BIC   logLik deviance df.resid 
##   4578.1   4627.6  -2281.0   4562.1     3590 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -1.5044 -0.7527 -0.5699  0.9989  2.4753 
## 
## Random effects:
##  Groups  Name        Variance Std.Dev.
##  Video2  (Intercept) 0.148984 0.38598 
##  Subject (Intercept) 0.004501 0.06709 
## Number of obs: 3598, groups:  Video2, 60; Subject, 20
## 
## Fixed effects:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -1.02073    0.10790  -9.460  &lt; 2e-16 ***
## Exp2        -0.02244    0.13529  -0.166   0.8683    
## Time2        0.94381    0.12496   7.553 4.27e-14 ***
## Time3        1.11681    0.12508   8.929  &lt; 2e-16 ***
## Exp2:Time2  -0.73780    0.18000  -4.099 4.15e-05 ***
## Exp2:Time3  -0.44969    0.17744  -2.534   0.0113 *  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Correlation of Fixed Effects:
##            (Intr) Exp2   Time2  Time3  Ex2:T2
## Exp2       -0.624                            
## Time2      -0.645  0.512                     
## Time3      -0.645  0.511  0.557              
## Exp2:Time2  0.448 -0.715 -0.694 -0.386       
## Exp2:Time3  0.453 -0.725 -0.391 -0.703  0.546
```

---

## Visualisation of the results


```r
eff.p2 &lt;- effect("Exp*Time", AccMod,confidence.level=0.68)
eff.p2 &lt;- as.data.frame(eff.p2)

levels(eff.p2$Exp)=c('Experts','Novices',NA)
names(eff.p2)[1]='Expertise'
```

&lt;img src="Mixed-effect2_files/figure-html/unnamed-chunk-23-1.png" style="display: block; margin: auto;" /&gt;

---

## Mixed-effect Path models

PiecewiseSEM package: [LINK](https://cran.r-project.org/web/packages/piecewiseSEM/vignettes/piecewiseSEM.html) &lt;br/&gt;&lt;br/&gt;

Book: Cause and Correlation in Biology: A User's Guide to Path Analysis, Structural Equations and Causal Inference with R  

---

## Nonlinear modelling

Generalized additive mixed-effect modelling &lt;br/&gt;&lt;br/&gt;

Jacoline van Rij: [LINK](https://jacolienvanrij.com/Tutorials/GAMM.html)  &lt;br/&gt;&lt;br/&gt;

Modelling mouse movement in the experimental setting: [LINK](https://library.oapen.org/bitstream/handle/20.500.12657/37598/9783110440577.pdf?sequence=1#page=91)

---

## Bayesian modelling 

brms package in R: [LINK](https://paul-buerkner.github.io/brms/) &lt;br/&gt;&lt;br/&gt;

Families in brms: [LINK](https://rdrr.io/cran/brms/man/brmsfamily.html) &lt;br/&gt;&lt;br/&gt;

Andrew Gelman's blog: [LINK]( https://statmodeling.stat.columbia.edu/)

---
class: inverse, middle, center
# PSY6210: Advanced statistical methods for Psychologists 
---
## Recap of our work

Introduction to various advanced statistical models &lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;
General linear model as a basis for all other models: `\(y = \alpha + \beta * x + \epsilon\)` &lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;
.pull-left[
GLMs:&lt;br/&gt;
`\(log(\frac{p_{i}}{1-p_{i}}) =  \alpha+\beta*x_i\)`&lt;br/&gt;&lt;br/&gt;

Path models: &lt;br/&gt; 
`\(y_1 = \alpha_1 + \beta_1 * x + \epsilon_1\)` &lt;br/&gt;
`\(y_2 = \alpha_2 + \beta_2 * x +\beta_3*y_1 + \epsilon_2\)`
]
.pull-right[
CFA:&lt;br/&gt;
`\(y_1=\tau_1+\lambda_1*\eta+\epsilon_1\)`&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;

Mixed-effect model: &lt;br/&gt;
`\(y_i=\alpha_{j[i]}*\beta_{j[i]}*x_i+\epsilon_i\)` &lt;br/&gt;
]

---
## Materials 1

Each lecture was trying to explain statistical theory and motivate why and when would you want to use covered models &lt;br/&gt;&lt;br/&gt;

There are no recipes and that the best approach is to read and investigate these topics further, but also experiment with the models &lt;br/&gt;&lt;br/&gt; 

Topics that go beyond the general introduction to the statistical procedures &lt;br/&gt;  &lt;br/&gt;

Showcase possibilities of these models and introduce you to more advanced topics  &lt;br/&gt; &lt;br/&gt;

---

## Materials 2

Presentations + commented code for each lecture is online &lt;br/&gt;&lt;br/&gt;

Simulations for theoretical part &lt;br/&gt; &lt;br/&gt;

Using simulations to understand and test your models! &lt;br/&gt;&lt;br/&gt; 
Chapter 8 of "Data Analysis Using Regression and Multilevel/Hierarchical Models" by Andrew Gelman and Jennifer Hill

---

## Thank you for your attention 


    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"ratio": "16:9",
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_HTMLorMML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
